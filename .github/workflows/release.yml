name: Create and Merge Pull Request from DEV to MAIN

on:
  workflow_dispatch:

jobs:
  create-and-merge-pr:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v3

    - name: Configure Git
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"

    - name: Verify dev branch exists
      run: |
        if ! git show-ref --verify --quiet refs/heads/dev; then
          echo "Error: The branch 'dev' does not exist. Please create it first.";
          exit 1;
        fi

    - name: Create Pull Request
      id: create_pr
      uses: peter-evans/create-pull-request@v5
      with:
        branch: dev # Rama de origen
        base: main  # Rama de destino
        commit-message: "Auto: Actualizaci칩n de DEV a MAIN"
        title: "PR autom치tica de DEV a MAIN"
        body: |
          Este Pull Request fue generado autom치ticamente para pasar los cambios de `dev` a `main`.
        labels: 'automerge-dev-to-main'

    - name: Enable Auto-Merge
      if: steps.create_pr.outputs.pull-request-url != '' # Solo si el PR se cre칩 correctamente
      uses: pascalgn/automerge-action@v0.15.6
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }}
      with:
        merge_label: 'automerge-dev-to-main'